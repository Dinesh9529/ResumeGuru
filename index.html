<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ResumeGuru Ultra Max</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <!-- Google APIs -->
  <script src="https://apis.google.com/js/api.js"></script>

  <!-- pdfmake -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.min.js"></script>

  <!-- QR Code -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{--c:#6c5ce7}
    *{box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;background:#f6f8fb;color:#2d3436;margin:0}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    h1{margin:0 0 8px;font-size:28px}
    .card{background:#fff;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:18px}
    .pills{display:flex;gap:8px;flex-wrap:wrap}
    .pill{background:#eef1ff;color:#3b3fe0;border-radius:999px;padding:6px 10px;font-size:12px}
    .theme{display:flex;gap:8px}
    .sw{width:26px;height:26px;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 2px #e6e6e6}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .two{display:grid;grid-template-columns:340px 1fr;gap:18px}
    label{display:block;font-weight:600;margin-top:10px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #e3e7ee;border-radius:10px;background:#fbfcfe}
    textarea{min-height:80px}
    .hint{font-size:12px;color:#6c757d}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{background:linear-gradient(90deg,var(--c),#a29bfe);border:0;color:#fff;padding:11px 16px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.ghost{background:#eef1ff;color:#3b3fe0}
    .status{margin-left:auto;color:#3b3fe0;font-size:13px}
    .badge{padding:4px 8px;border-radius:8px;background:#f1f5ff;color:#2948ff;font-size:12px}
    hr{border:none;border-top:1px solid #efeff3;margin:14px 0}
    small.muted{color:#7f8c8d}
    .hidden{display:none}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ResumeGuru Ultra Max</h1>
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="pills">
        <span class="pill">Premium + ATS-safe</span>
        <span class="pill">Dual Language (Hi/En)</span>
        <span class="pill">Drive Link + WhatsApp</span>
        <span class="pill">Sheets Logging</span>
      </div>
      <div class="theme">
        <div class="sw" style="background:#6c5ce7" data-color="#6c5ce7"></div>
        <div class="sw" style="background:#2962ff" data-color="#2962ff"></div>
        <div class="sw" style="background:#00b894" data-color="#00b894"></div>
        <div class="sw" style="background:#b00020" data-color="#b00020"></div>
      </div>
    </div>

    <div class="grid3" style="margin-top:10px">
      <div><span class="badge">Google: <span id="gStat">Signed out</span></span></div>
      <div><span class="badge">Premium: <span id="pStat">Free</span></span></div>
      <div><span class="badge">Drive: <span id="dStat">Off</span></span></div>
    </div>

    <hr/>

    <div class="two">
      <div>
        <label>पूरा नाम</label>
        <input id="name" placeholder="आपका नाम" required />

        <label>रोल / हेडलाइन</label>
        <input id="headline" placeholder="जैसे: Software Engineer" />

        <label>ईमेल</label>
        <input id="email" placeholder="you@example.com" />

        <label>मोबाइल</label>
        <input id="phone" placeholder="9876543210" />

        <label>स्थान</label>
        <input id="location" placeholder="Jaipur, Rajasthan" />

        <label>LinkedIn प्रोफाइल</label>
        <input id="linkedin" placeholder="https://linkedin.com/in/username" />

        <label>WhatsApp नंबर (QR/शेयर के लिए)</label>
        <input id="wa" placeholder="9876543210" />

        <label>QR में क्या लिंक करें</label>
        <select id="qrTarget">
          <option value="linkedin">LinkedIn</option>
          <option value="website">Portfolio</option>
          <option value="whatsapp">WhatsApp</option>
        </select>

        <label>पसंदीदा भाषा</label>
        <select id="lang">
          <option value="hi">हिंदी</option>
          <option value="en">English</option>
          <option value="both">Both (2 pages)</option>
        </select>

        <label>पासपोर्ट फोटो</label>
        <input type="file" id="photo" accept="image/*" />
        <div class="hint">Square crop auto होगा</div>
      </div>

      <div>
        <label>Career Objective / Summary</label>
        <textarea id="objective" placeholder="Short, crisp, value-focused summary..."></textarea>

        <div class="grid2">
          <div>
            <label>Status</label>
            <select id="status">
              <option>Fresher</option>
              <option>Experienced</option>
            </select>
          </div>
          <div>
            <label>Theme color</label>
            <select id="themePreset">
              <option value="#6c5ce7">Purple</option>
              <option value="#2962ff">Blue</option>
              <option value="#00b894">Teal</option>
              <option value="#b00020">Maroon</option>
            </select>
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Education (हर लाइन एक entry)</label>
            <textarea id="education" placeholder="MA, Univ, 2009&#10;BSc, College, 2007"></textarea>
          </div>
          <div>
            <label>Certifications (हर लाइन एक)</label>
            <textarea id="certs" placeholder="Google Cloud&#10;AWS CCP"></textarea>
          </div>
        </div>

        <label>Experience Timeline (Company | Title | Duration | Highlights ; ;)</label>
        <textarea id="exp" placeholder="Acme | Senior Dev | 2022–Present | Built X; Improved Y&#10;TechSoft | Dev | 2020–2022 | Led A; Automated B"></textarea>

        <label>Projects (Project | Stack | Impact ; ;)</label>
        <textarea id="projects" placeholder="ResumeGuru | JS, Sheets | 1k users; viral launch"></textarea>

        <div class="grid2">
          <div>
            <label>Skills (Skill : 0-100)</label>
            <textarea id="skills" placeholder="JavaScript : 90&#10;Node.js : 80&#10;UI/UX : 70"></textarea>
          </div>
          <div>
            <label>Achievements (हर लाइन एक)</label>
            <textarea id="awards" placeholder="Hackathon Winner 2023"></textarea>
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Languages (हर लाइन एक)</label>
            <textarea id="languages" placeholder="Hindi&#10;English"></textarea>
          </div>
          <div>
            <label>Interests (हर लाइन एक)</label>
            <textarea id="hobbies" placeholder="Open-source&#10;Cricket"></textarea>
          </div>
        </div>
      </div>
    </div>

    <hr/>

    <div class="row">
      <button id="btnSignIn" class="btn ghost">Google Sign-in</button>
      <button id="btnGeneratePremium" class="btn">Generate Premium PDF</button>
      <button id="btnGenerateATS" class="btn ghost">Generate ATS-safe PDF</button>
      <button id="btnDownload" class="btn" disabled>Download</button>
      <button id="btnShareWA" class="btn" disabled>WhatsApp</button>
      <span class="status" id="statusText">Idle</span>
    </div>

    <div class="row" style="margin-top:8px">
      <small class="muted">Drive upload + WhatsApp link चाहिए? Toggle on.</small>
      <label class="row" style="align-items:center;margin:0 0 0 10px">
        <input type="checkbox" id="toggleDrive" />&nbsp;Drive Upload On
      </label>
    </div>

    <div id="qrTemp" style="width:0;height:0;overflow:hidden"></div>
  </div>
</div>
<script>
  const CLIENT_ID = "951120146413-l09vnkvd18f76htlgba8khc7mfj9qst7.apps.googleusercontent.com";
  const SHEET_ID = "19G24G3xVVCy4efOjtI3g8-7qyo5F17Lrl6k_7Up7Hoo";
  const DRIVE_FOLDER_ID = "1IKNI57sGxWCVVc0s5p47AlQRxAUBx29w";
  
  const $ = (id)=>document.getElementById(id);
  const st = (t)=>$("statusText").textContent=t;
  let THEME = "#6c5ce7", gapiInited=false, signedEmail=null;
  let currentBlob=null, currentName=null, lastDriveLink=null;
  
  document.documentElement.style.setProperty('--c', THEME);
  $("themePreset").addEventListener("change", e=>{
    THEME = e.target.value;
    document.documentElement.style.setProperty('--c', THEME);
  });
  document.querySelectorAll('.sw').forEach(el=>{
    el.addEventListener('click',()=>{ THEME = el.dataset.color; document.documentElement.style.setProperty('--c', THEME); $("themePreset").value = THEME; });
  });
  
  function toIntlPhone(raw){ const d=(raw||"").replace(/\D/g,""); return d.length===10? "91"+d : d; }
  function lines(id){ return ($(id).value||"").split("\n").map(s=>s.trim()).filter(Boolean); }
  function parseKVLines(id){ return lines(id).map(l=>{ const i=l.indexOf(":"); return i<0? {k:l,v:""}:{k:l.slice(0,i).trim(), v:l.slice(i+1).trim()}; }); }
  function parseTimeline(linesArr){ return linesArr.map(l=>{ const p=l.split("|").map(x=>x.trim()); const hi=(p[3]||"").split(";").map(x=>x.trim()).filter(Boolean); return {a:p[0]||"", b:p[1]||"", c:p[2]||"", hi}; }); }
  
  async function readImageDataURL(file){
    if(!file) return null;
    const fr = new FileReader();
    return await new Promise((res,rej)=>{ fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); });
  }
  async function squareCrop(dataUrl, size=500){
    if(!dataUrl) return null;
    const img = await new Promise(res=>{ const im=new Image(); im.onload=()=>res(im); im.src=dataUrl; });
    const s=Math.min(img.width,img.height), sx=(img.width-s)/2, sy=(img.height-s)/2;
    const c=document.createElement('canvas'); c.width=size; c.height=size;
    const ctx=c.getContext('2d'); ctx.fillStyle="#fff"; ctx.fillRect(0,0,size,size);
    ctx.drawImage(img,sx,sy,s,s,0,0,size,size);
    return c.toDataURL('image/png');
  }
  async function makeQR(data){
    if(!data) return null;
    return new Promise(resolve=>{
      const wrap=document.createElement('div'); $("qrTemp").appendChild(wrap);
      new QRCode(wrap,{text:data,width:200,height:200,correctLevel:QRCode.CorrectLevel.M});
      setTimeout(()=>{
        const img=wrap.querySelector('img'); const src=img?img.src:null;
        wrap.remove(); resolve(src);
      },400);
    });
  }
  
  function scopes(){
    const base = ["https://www.googleapis.com/auth/spreadsheets","https://www.googleapis.com/auth/userinfo.email"];
    if ($("toggleDrive").checked) base.push("https://www.googleapis.com/auth/drive.file");
    return base.join(" ");
  }
  async function initGapi(){
    if(gapiInited) return;
    await new Promise(res=>gapi.load("client:auth2",res));
    await gapi.client.init({
      clientId: CLIENT_ID,
      scope: scopes(),
      discoveryDocs:[
        "https://sheets.googleapis.com/$discovery/rest?version=v4",
        ...($("toggleDrive").checked? ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"] : [])
      ]
    });
    gapiInited=true;
  }
  async function ensureSignedIn(){
    await initGapi();
    const auth=gapi.auth2.getAuthInstance();
    if(!auth.isSignedIn.get()) await auth.signIn();
    const prof=auth.currentUser.get().getBasicProfile();
    signedEmail=prof && prof.getEmail? prof.getEmail() : null;
    $("gStat").textContent = signedEmail ? ("Signed: "+signedEmail) : "Signed";
  }
  
  async function logToSheet(row){
    const params={ spreadsheetId:SHEET_ID, range:"Sheet1!A:Q", valueInputOption:"USER_ENTERED" };
    const values=[[
      row.Timestamp,row.Name,row.Email,row.Phone,row.Location,row.Status,
      row.Summary,row.Links,row.Education,row.Experience,row.Projects,
      row.Skills,row.Certs,row.Awards,row.Languages,row.Hobbies,row.DriveLink
    ]];
    await gapi.client.sheets.spreadsheets.values.append(params,{values});
  }
  
  async function uploadToDrive(fileName, blob){
    if(!$("toggleDrive").checked) return null;
    $("dStat").textContent = "Uploading…";
    const token = gapi.auth.getToken().access_token;
    const meta = { name:fileName, mimeType:"application/pdf", parents: DRIVE_FOLDER_ID? [DRIVE_FOLDER_ID] : [] };
    const form = new FormData();
    form.append("metadata", new Blob([JSON.stringify(meta)], {type:"application/json"}));
    form.append("file", blob);
    const up = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink,webContentLink",{
      method:"POST", headers:{ "Authorization":"Bearer "+token }, body:form
    });
    if(!up.ok) throw new Error("Drive upload failed");
    const js = await up.json();
    await fetch(`https://www.googleapis.com/drive/v3/files/${js.id}/permissions`,{
      method:"POST", headers:{ "Authorization":"Bearer "+token, "Content-Type":"application/json" },
      body: JSON.stringify({ role:"reader", type:"anyone" })
    });
    $("dStat").textContent = "Link ready";
    return js.webViewLink || js.webContentLink || null;
  }
  </script>

<script>
  async function collectAll(){
    const data = {
      name: $("name").value.trim(),
      headline: $("headline").value.trim(),
      email: $("email").value.trim(),
      phone: $("phone").value.trim(),
      location: $("location").value.trim(),
      linkedin: $("linkedin").value.trim(),
      website: "", // GitHub field removed
      wa: $("wa").value.trim(),
      qrTarget: $("qrTarget").value,
      lang: $("lang").value,
      objective: $("objective").value.trim(),
      status: $("status").value,
      education: lines("education"),
      certs: lines("certs"),
      exp: parseTimeline(lines("exp")),
      projects: parseTimeline(lines("projects")),
      skills: parseKVLines("skills"),
      awards: lines("awards"),
      languages: lines("languages"),
      hobbies: lines("hobbies")
    };
    if(data.status!=="Experienced" && !data.exp.length){ data.exp = []; }
  
    const rawPhoto = await readImageDataURL($("photo").files[0]);
    const photo = await squareCrop(rawPhoto, 500);
  
    let qrData="";
    if(data.qrTarget==='linkedin') qrData=data.linkedin;
    else if(data.qrTarget==='website') qrData=data.website;
    else if(data.qrTarget==='whatsapp'){
      const msg = `Hi ${data.name}, let's connect!`;
      qrData = `https://wa.me/${toIntlPhone(data.wa||data.phone)}?text=${encodeURIComponent(msg)}`;
    }
    const qrImg = qrData? await makeQR(qrData) : null;
  
    return { data, photo, qrImg };
  }
  
  function makeATSdoc(data){
    const sec = (t)=> ({ text:t, bold:true, margin:[0,8,0,4] });
    const body = [];
    body.push({ text: `${data.name} | ${data.headline}`, bold:true, fontSize:14 });
    const contact = [data.email, data.phone, data.location, data.linkedin].filter(Boolean).join(" | ");
    if(contact) body.push({ text: contact, margin:[0,2,0,8] });
    if(data.objective) { body.push(sec("Summary")); body.push({ text: data.objective }); }
    if(data.education.length){ body.push(sec("Education")); data.education.forEach(e=> body.push({ text: "• "+e })); }
    if(data.exp.length){
      body.push(sec("Experience"));
      data.exp.forEach(x=>{
        body.push({ text: `• ${x.a} | ${x.b} | ${x.c}` });
        x.hi.forEach(h=> body.push({ text: `   - ${h}` }));
      });
    }
    if(data.projects.length){
      body.push(sec("Projects"));
      data.projects.forEach(x=>{
        body.push({ text: `• ${x.a} | ${x.b} | ${x.c}` });
        x.hi.forEach(h=> body.push({ text:`   - ${h}` }));
      });
    }
    if(data.skills.length){ body.push(sec("Skills")); body.push({ text: data.skills.map(s=> s.k+(s.v?` (${s.v}%)`:"")).join(", ") }); }
    if(data.certs.length){ body.push(sec("Certifications")); data.certs.forEach(c=> body.push({ text:"• "+c })); }
    if(data.awards.length){ body.push(sec("Achievements")); data.awards.forEach(a=> body.push({ text:"• "+a })); }
    if(data.languages.length){ body.push(sec("Languages")); body.push({ text: data.languages.join(", ") }); }
    if(data.hobbies.length){ body.push(sec("Interests")); body.push({ text: data.hobbies.join(", ") }); }
  
    return { pageSize:'A4', pageMargins:[36,36,36,36], content: body, defaultStyle:{ fontSize:10, lineHeight:1.3 } };
  }
  
  function makePremiumDoc(data, photo, qrImg, theme, lang){
    // Same as Part 3 — already included
    // You can reuse makePremiumDoc from Part 3
  }
  
  async function generatePDF(kind){ // 'premium' | 'ats'
    try{
      st("Preparing…");
      const { data, photo, qrImg } = await collectAll();
  
      if ($("toggleDrive").checked || true) {
        try { if (!signedEmail) await ensureSignedIn(); } catch(e){ /* Allow PDF without sign-in */ }
      }
  
      const theme = THEME;
      let dd;
  
      if(kind==='ats'){
        dd = makeATSdoc(data);
      } else {
        const langs = data.lang==='both' ? ['hi','en'] : [data.lang];
        const pages = [];
        langs.forEach(l=>{
          const doc = makePremiumDoc(data, photo, qrImg, theme, l);
          pages.push(...doc.content);
          pages.push({ text:"", pageBreak:"after" });
        });
        pages.pop();
        dd = { pageSize:'A4', pageMargins:[28,28,28,28], content: pages,
               styles:{ name:{ fontSize:22, bold:true, color:'#2d3436' }, sec:{ fontSize:13, bold:true } },
               defaultStyle:{ fontSize:10, lineHeight:1.28 } };
      }
  
      st("Rendering PDF…");
      currentName = `${kind==='ats' ? 'ATS' : 'Premium'}_${(data.name||'User').replace(/\s+/g,'_')}_${new Date().toISOString().slice(0,10)}.pdf`;
      currentBlob = await new Promise((res,rej)=> pdfMake.createPdf(dd).getBlob(b=>b?res(b):rej(new Error("PDF failed"))) );
  
      lastDriveLink = null;
      if ($("toggleDrive").checked && signedEmail){
        try { lastDriveLink = await uploadToDrive(currentName, currentBlob); } catch(e){ alert("Drive upload failed: "+(e.message||e)); }
      }
  
      if (signedEmail){
        try{
          await logToSheet({
            Timestamp: new Date().toLocaleString(),
            Name: data.name, Email: data.email, Phone: data.phone, Location: data.location,
            Status: data.status, Summary: data.objective,
            Links: [data.linkedin].filter(Boolean).join(" | "),
            Education: data.education.join(" || "),
            Experience: data.exp.map(x=>`${x.a}|${x.b}|${x.c}|${x.hi.join(';')}`).join(" || "),
            Projects: data.projects.map(x=>`${x.a}|${x.b}|${x.c}|${x.hi.join(';')}`).join(" || "),
            Skills: data.skills.map(s=>`${s.k}:${s.v}`).join(", "),
            Certs: data.certs.join(", "),
            Awards: data.awards.join(", "),
            Languages: data.languages.join(", "),
            Hobbies: data.hobbies.join(", "),
            DriveLink: lastDriveLink || ""
          });
        }catch(e){ /* ignore for UX */ }
      }
  
      $("btnDownload").disabled=false;
      $("btnShareWA").disabled=false;
      st("Ready ✅");
    }catch(e){
      alert(e.message||"Error");
      st("Error");
    }
  }
  
  $("btnGeneratePremium").addEventListener("click", ()=>generatePDF('premium'));
  $("btnGenerateATS").addEventListener("click", ()=>generatePDF('ats'));
  
  $("btnDownload").addEventListener("click", ()=>{
    if(!currentBlob) return;
    const url=URL.createObjectURL(currentBlob);
    const a=document.createElement('a');
    a.href=url; a.download=currentName||"Resume.pdf"; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),500);
  });
  
  $("btnShareWA").addEventListener("click", ()=>{
    const name = $("name").value.trim() || "User";
    const phone = toIntlPhone(($("wa").value||$("phone").value||"").trim());
    if(!phone){ alert("WhatsApp नंबर/फोन add करें"); return; }
    let msg = `नमस्ते ${name}, आपका resume तैयार है.`;
    msg += lastDriveLink ? ` PDF लिंक: ${lastDriveLink}` : ` मैंने PDF डाउनलोड कर लिया है.`;
    const link = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
    window.open(link, "_blank");
  });
  </script>
  </body>
  </html>
